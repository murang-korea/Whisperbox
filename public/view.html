<!doctype html>
<html lang="ko">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>ê¸€ ë³´ê¸°</title><link rel="stylesheet" href="style.css" /></head>
<body>
<div class="header">ğŸ’¬ WhisperBox - ê¸€ ë³´ê¸°</div>
<div class="container">
  <div id="postCard" class="card"></div>
  <div class="card">
    <h3>ëŒ“ê¸€</h3>
    <div id="commentsArea"></div>
    <textarea id="replyText" rows="3" placeholder="ëŒ“ê¸€ ì…ë ¥"></textarea>
    <div class="row"><button id="replyBtn">ëŒ“ê¸€ ë‹¬ê¸°</button><button onclick="location.href='index.html'">ëª©ë¡</button></div>
  </div>
</div>
<script src="script.js"></script>
<script>
(async()=>{
  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  if(!id){ alert("ì˜ëª»ëœ ì ‘ê·¼"); location.href="index.html"; return; }
  await showCurrentUser();
  await loadPost(id);

  document.getElementById("replyBtn").addEventListener("click", async()=>{
    const text=document.getElementById("replyText").value.trim();
    if(!text) return alert("ëŒ“ê¸€ ì…ë ¥");
    const res=await fetch(`/api/posts/${id}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text})});
    const data=await res.json();
    if(data.success){ await loadPost(id); document.getElementById("replyText").value=""; }
    else alert(data.error||"ëŒ“ê¸€ ì‹¤íŒ¨");
  });
})();
</script>
</body>
</html>
