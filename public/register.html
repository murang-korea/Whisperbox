<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WhisperBox - 회원가입</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <div class="brand"><h1>WhisperBox</h1></div>
  </header>

  <main class="container">
    <div class="card form" style="max-width:560px;margin:20px auto">
      <h2>회원가입</h2>
      <input id="usernameInput" placeholder="아이디" style="width:100%;padding:8px;margin-top:8px"/><br><br>
      <input id="passwordInput" type="password" placeholder="비밀번호" style="width:100%;padding:8px;margin-top:8px"/><br><br>
      <div style="display:flex;gap:8px;justify-content:space-between;">
        <button id="regBtn" style="background-color:#ffb366;">가입하기</button>
        <button onclick="location.href='login.html'">취소</button>
      </div>
    </div>
  </main>

<script src="script.js"></script>
<script>
document.getElementById("regBtn").addEventListener("click", async ()=>{
  const username = document.getElementById("usernameInput").value.trim();
  const password = document.getElementById("passwordInput").value.trim();

  if(!username || !password) {
    alert("아이디와 비밀번호를 입력해주세요.");
    return;
  }

  try {
    const res = await fetch("/api/register", {
      method: "POST",
      credentials: "include", // ✅ 세션 쿠키 유지
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({username, password})
    });
    const data = await res.json();

    if(res.ok && data.ok){
      alert("회원가입 성공! 로그인 페이지로 이동합니다.");
      location.href = "login.html";
    } else {
      alert(data.error || "회원가입 실패");
    }
  } catch(e){
    console.error(e);
    alert("회원가입 중 오류 발생");
  }
});
</script>
</body>
</html>
