<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ğŸ§¡ WhisperBox</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header">
    ğŸ§¡ WhisperBox
    <div style="position:absolute; right:20px; top:14px;">
      <button id="authBtn" class="ghost" style="font-size:0.9rem;padding:6px 10px;"></button>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <h2>ìµœê·¼ ê¸€</h2>
      <div id="postList"></div>
      <button id="writeBtn" style="margin-top:12px;">âœï¸ ìƒˆ ê¸€ ì‘ì„±</button>
    </div>
  </div>

  <div class="footer">Â© 2025 WhisperBox</div>

  <script src="script.js"></script>
  <script>
  (async ()=>{
    const user = await showCurrentUser(false);
    const authBtn = document.getElementById("authBtn");

    if(user){
      authBtn.textContent = "ğŸšª ë¡œê·¸ì•„ì›ƒ";
      authBtn.onclick = logout;
    }else{
      authBtn.textContent = "ğŸ” ë¡œê·¸ì¸";
      authBtn.onclick = ()=>location.href="login.html";
    }

    // ê¸€ ëª©ë¡ ë¡œë“œ
    const res = await fetch("/api/posts");
    const posts = await res.json();
    const list = document.getElementById("postList");
    if(posts.length === 0) list.innerHTML = "<p>ì•„ì§ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
    else list.innerHTML = posts.map(p=>`
      <div class="post">
        <strong>${p.title}</strong><br>
        <small>by ${p.author} â€¢ ${new Date(p.created_at).toLocaleString()}</small>
      </div>
    `).join("");

    // ê¸€ì“°ê¸° ë²„íŠ¼
    document.getElementById("writeBtn").addEventListener("click", ()=>{
      if(!user){
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
        location.href="login.html";
      } else {
        location.href="write.html";
      }
    });
  })();
  </script>
</body>
</html>
