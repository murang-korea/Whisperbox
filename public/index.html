<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WhisperBox - 목록</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header">
    <div class="brand"><h1>WhisperBox</h1><div class="small">작고 조용한 글방</div></div>
    <div id="authArea" class="actions"></div>
  </header>

  <main class="container">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <h2>최근 글</h2>
      <div>
        <button class="btn" onclick="location.href='write.html'">새 글 작성</button>
      </div>
    </div>

    <div id="list" class="list"></div>
    <div class="footer">© WhisperBox</div>
  </main>

  <script src="script.js"></script>
  <script>
  (async function(){
    await renderHeaderAuth('#authArea');

    try {
      const data = await api('/api/posts');
      const listEl = document.getElementById('list');
      if(!data || data.length === 0) {
        listEl.innerHTML = '<div class="card small">게시글이 없습니다.</div>';
        return;
      }
      listEl.innerHTML = data.map(p => `
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div>
              <div class="post-title"><a href="view.html?id=${p.id}">${escapeHtml(p.title)}</a></div>
              <div class="small">by ${escapeHtml(p.author)} · ${new Date(p.date).toLocaleString()}</div>
            </div>
          </div>
          <div class="post-content">${escapeHtml(p.content).slice(0, 300)}${p.content.length > 300 ? '…' : ''}</div>
        </div>
      `).join('');
    } catch(e) { console.error(e); showMsg(e.message || '불러오기 실패'); }
  })();
  </script>
</body>
</html>
