<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>📜 WhisperBox</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header">
    📜 WhisperBox
    <div id="userArea" style="float:right"></div>
  </div>

  <div class="container">
    <button id="writeBtn" style="background-color:#ffb366;margin-bottom:10px;">✏️ 새 글 작성</button>
    <div id="postList"></div>
  </div>

  <script src="script.js"></script>
  <script>
  (async function(){
    const user = await showCurrentUser();

    // 로그인 상태에 따라 버튼 표시
    const userArea = document.getElementById("userArea");
    if(user){
      userArea.innerHTML = `${user.username}님 | <a href="#" id="logoutBtn">로그아웃</a>`;
      document.getElementById("logoutBtn").onclick = logout;
    } else {
      userArea.innerHTML = `<a href="login.html">로그인</a>`;
    }

    document.getElementById("writeBtn").addEventListener("click", ()=>{
      if(!user) {
        alert("로그인 후 작성할 수 있습니다!");
        location.href = "login.html";
        return;
      }
      location.href = "write.html";
    });

    // 게시글 목록 불러오기
    const res = await fetch("/api/posts");
    const posts = await res.json();
    const postList = document.getElementById("postList");

    if(posts.length === 0){
      postList.innerHTML = "<p>아직 게시글이 없습니다.</p>";
    } else {
      postList.innerHTML = posts.map(p=>`
        <div class="card" style="margin-top:10px;cursor:pointer" onclick="location.href='view.html?id=${p.id}'">
          <h3>${p.title}</h3>
          <p>${p.content.slice(0,80)}...</p>
          <small>✏️ ${p.author} | 🕒 ${new Date(p.date).toLocaleString()}</small>
        </div>
      `).join("");
    }
  })();
  </script>
</body>
</html>
