<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ğŸ“œ WhisperBox</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header">
    ğŸ“œ WhisperBox
    <div id="userArea" style="float:right"></div>
  </div>

  <div class="container">
    <button id="writeBtn" style="background-color:#ffb366;margin-bottom:10px;">âœï¸ ìƒˆ ê¸€ ì‘ì„±</button>
    <div id="postList"></div>
  </div>

  <script src="script.js"></script>
  <script>
  (async function(){
    const user = await showCurrentUser();

    // ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í‘œì‹œ
    const userArea = document.getElementById("userArea");
    if(user){
      userArea.innerHTML = `${user.username}ë‹˜ | <a href="#" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</a>`;
      document.getElementById("logoutBtn").onclick = logout;
    } else {
      userArea.innerHTML = `<a href="login.html">ë¡œê·¸ì¸</a>`;
    }

    document.getElementById("writeBtn").addEventListener("click", ()=>{
      if(!user) {
        alert("ë¡œê·¸ì¸ í›„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
        location.href = "login.html";
        return;
      }
      location.href = "write.html";
    });

    // ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    const res = await fetch("/api/posts");
    const posts = await res.json();
    const postList = document.getElementById("postList");

    if(posts.length === 0){
      postList.innerHTML = "<p>ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
    } else {
      postList.innerHTML = posts.map(p=>`
        <div class="card" style="margin-top:10px;cursor:pointer" onclick="location.href='view.html?id=${p.id}'">
          <h3>${p.title}</h3>
          <p>${p.content.slice(0,80)}...</p>
          <small>âœï¸ ${p.author} | ğŸ•’ ${new Date(p.date).toLocaleString()}</small>
        </div>
      `).join("");
    }
  })();
  </script>
</body>
</html>
