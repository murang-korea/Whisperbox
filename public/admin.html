<!doctype html>
<html lang="ko">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>ê´€ë¦¬ì - WhisperBox</title><link rel="stylesheet" href="style.css" /></head>
<body>
  <div class="header">ğŸ”§ WhisperBox - ê´€ë¦¬ì</div>
  <div class="container">
    <div class="card" id="adminCard">
      <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
      <input id="adminUser" placeholder="ê´€ë¦¬ì ì•„ì´ë””"/>
      <input id="adminPass" type="password" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸"/>
      <div class="row">
        <button id="adminLoginBtn">ë¡œê·¸ì¸</button>
        <button onclick="location.href='index.html'">ë’¤ë¡œ</button>
      </div>
      <div id="adminArea" style="margin-top:12px; display:none">
        <h4>ìœ ì € ëª©ë¡</h4>
        <div id="usersList"></div>
        <h4 style="margin-top:12px">ê²Œì‹œê¸€</h4>
        <div id="adminPosts"></div>
        <div style="margin-top:12px" class="row">
          <button id="resetDBBtn">DB ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>
  </div>

<script src="script.js"></script>
<script>
document.getElementById("adminLoginBtn").addEventListener("click", async ()=>{
  const username = document.getElementById("adminUser").value.trim();
  const password = document.getElementById("adminPass").value.trim();
  const res = await fetch("/api/login", {
    method:"POST", headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ username, password })
  });
  const data = await res.json();
  if(data?.isAdmin || (data?.success && data?.nickname === "ê´€ë¦¬ì")) {
    alert("ê´€ë¦¬ì ì¸ì¦ë¨");
    document.getElementById("adminArea").style.display = "block";
    loadAdminData();
  } else {
    alert(data?.error || data?.message || "ê´€ë¦¬ì ì¸ì¦ ì‹¤íŒ¨");
  }
});

async function loadAdminData(){
  const usersRes = await fetch("/api/admin/users");
  if(usersRes.ok){
    const usersData = await usersRes.json();
    document.getElementById("usersList").innerHTML = (usersData.users||[]).map(u => `<div>${u.username} (${u.nickname})</div>`).join("") || "<div>ìœ ì € ì—†ìŒ</div>";
  } else {
    document.getElementById("usersList").innerText = "ìœ ì € ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
  }

  const postsRes = await fetch("/api/posts");
  const postsData = await postsRes.json();
  const postsList = postsData.posts || [];
  document.getElementById("adminPosts").innerHTML = postsList.map(p => `
    <div style="border:1px solid #eee;padding:8px;border-radius:8px;margin-bottom:8px">
      <div style="font-weight:700">${p.title} - ${p.author}</div>
      <div style="font-size:13px;color:#666">${p.content.slice(0,120)}</div>
      <div style="margin-top:6px"><button onclick="adminDeletePost(${p.id})">ì‚­ì œ</button></div>
    </div>
  `).join("") || "<div>ê²Œì‹œê¸€ ì—†ìŒ</div>";
}

async function adminDeletePost(id){
  if(!confirm("ì •ë§ ì‚­ì œí• ê¹Œìš”?")) return;
  const res = await fetch(`/api/admin/posts/${id}`, { method:"DELETE" });
  if(res.ok){ alert("ì‚­ì œ ì™„ë£Œ"); loadAdminData(); } else alert("ì‚­ì œ ì‹¤íŒ¨");
}

document.getElementById("resetDBBtn").addEventListener("click", async ()=>{
  if(!confirm("DBë¥¼ ì´ˆê¸°í™”í•˜ë©´ ë³µêµ¬ ë¶ˆê°€í•©ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?")) return;
  const res = await fetch("/api/admin/reset", { method:"POST" });
  if(res.ok) { alert("ì™„ë£Œ"); loadAdminData(); } else alert("ì‹¤íŒ¨");
});
</script>
</body>
</html>
